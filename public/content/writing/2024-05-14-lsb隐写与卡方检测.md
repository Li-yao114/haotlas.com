---
title: LSB隐写与卡方检测
date: 2024-05-14 09:53:04
lang: zh
summary: lsb隐写与卡方检测
---
一、实验任务

任务一 LSB图像信息隐藏

1.实验目的：

了解信息隐藏中最常用的LSB算法特点，掌握LSB算法的原理，设计并实现一种基于图像的LSB隐藏算法。

2.实验环境：

Python；

BMP灰度图像文件。

3.实验要求：

算法分三部分实现：

①隐藏信息的算法；

②提取信息的算法；

③写一个测试函数，可以调用以上两个函数实现二进制随机流的存储与提取。

任务二 卡方分析

1.实验目的：

了解什么是卡方分析，实现基于任务一的结果的卡方分析，计算出每张图片被隐写的概率。

2.实验环境：

Python；

隐写图像文件。

3.实验要求：

①进行卡方分析的算法；

②写一个测试函数，可以调用卡方分析函数实现对图片是否被隐写进行判断。

使用Lena图像作为测试图像：

[![](https://haotlas.cn/wp-content/uploads/2024/05/20200228145935541.bmp)](https://haotlas.cn/wp-content/uploads/2024/05/20200228145935541.bmp)

二、代码

```text
from PIL import Image
import cv2
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import chisquare
from scipy.stats import chi2

# LSB 隐写
def lsb_steganography(image_path, message ,n_bits):
    img = Image.open(image_path).convert('L')  # 转换为灰度图像
    binary_message = ''.join(format(ord(i), '08b') for i in message)  # 消息转换为二进制
    delimiter = '1' * (n_bits * 8) + '0' * n_bits      # 用结束符来标记消息的结束
    binary_message += delimiter
    data_index=0

    # 将二进制编码分割为 n_bits 位的块
    bit_chunks = [binary_message[i:i+n_bits] for i in range(0, len(binary_message), n_bits)]

    for row in range(img.height):
        for col in range(img.width):
            if data_index = 256:
            break

        # 计算并累加卡方值
        if hist_stego2[i] != 0:
            r += ((hist_stego[i] - hist_stego2[i]) ** 2) / hist_stego2[i]
            k += 1

    print(f"r = {r}, k-1 = {k-1}")

    # 计算p值
    p_value = 1 - chi2.cdf(r, 255)

    return p_value

# 图像的像素值分布
pixel_distribution('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\image_path.png')

with open('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\msg.txt','r',encoding='utf-8') as f:
    msg = f.read()

# 使用 LSB 隐写
stego_image = lsb_steganography('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\image_path.png', msg , 1 )
stego_image.save('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\stego_image.png')

# 从隐写图像中提取信息
decoded = extract_message('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\stego_image.png', 1 )

# print('Extracted message:', message)
with open('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\decode.txt','w',encoding='utf-8') as f:
    f.write(decoded)

# 执行卡方检测
p_value = chi_square_detection('d:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\stego_image.png', 'd:\\Users\\asus\\Desktop\\物联网安全\\实验二\\LSB\\image_path.png')

# 输出p值
print(f"P-value = {p_value:.9f}")
```

三、实验结果

能成功隐写和提取出对应信息，且在需要隐写的消息不同的情况下，p值会有所改变，大概结果在0.4-0.7几之间。

例如文本为：”hello world”,结果为：

[![](https://haotlas.cn/wp-content/uploads/2024/05/QQ图片20240514094201.png)](https://haotlas.cn/wp-content/uploads/2024/05/QQ图片20240514094201.png)

灰度直方对比图如下：

[![](https://haotlas.cn/wp-content/uploads/2024/05/myplot.png)](https://haotlas.cn/wp-content/uploads/2024/05/myplot.png)

四、实验心得

在这个实验中，我们对LSB隐写技术、BMP灰度图像和卡方检测的相关知识进行了了解，并且利用Python编程实现了LSB隐写和卡方检测。

LSB 隐藏文字的核心思想是将消息的二进制数据嵌入图像的像素值中，通常嵌入每个像素的最低位置。这样，消息就可以隐藏起来，而不会引起肉眼可见的变化。我们编写了一个函数来嵌入图像中的消息，并编写了一个函数来从图像中获取隐藏的消息。通过实现这些函数，我们对LSB隐写的相关概念有了更加清楚的了解。一开始我们只实现了1位的隐写替换，而后我们对代码进行了改进，是其能够对后n_bits位进行隐写。

在实验中，我们还使用卡片检测方法来测试图像中是否有隐藏的信息。卡片检测是一种常见的隐藏检测方法。它通过比较含有隐藏信息的图像和原始图像的像素分布特征来测试隐藏信息的出现。在一开始的时候，我们得到的结果p始终为0，虽然能得到原图和隐写图像的灰度直方图，但却无法判断出图片是否被隐写，而后在对实验ppt研究后对代码进行了修改，得到的结果是在隐写的情况下，通过卡方检测判断出来的概率为0.4-0.7几之间。

总的来说，通过这个实验，我们不仅学会了LSB隐藏技术的原理和实现方法，还学会了卡方检测的相关知识和原理，我们小组成员也在改进Python代码同时，对图像处理和隐写测试有了更深入的了解。这些知识和技能对我们在信息安全领域的学习和生活具有重要意义。